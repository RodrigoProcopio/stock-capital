<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Capital MFO</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- 1) Se houver token (#invite_token ou #confirmation_token), manda direto para /admin mantendo o hash -->
    <script>
      (function () {
        var h = window.location.hash || "";
        if (/#(?:invite_token|confirmation_token)=/.test(h)) {
          // replace evita criar histórico extra
          window.location.replace("/admin/" + h);
        }
      })();
    </script>

    <!-- 2) Sua SPA -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- 3) Netlify Identity Widget (fallback na home) -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.init();
        window.netlifyIdentity.on("login", function (user) {
          console.log("Usuário logado via home:", user);
          // Se o processamento ocorrer aqui, ainda assim levamos ao CMS
          window.location.href = "/admin/";
        });
        window.netlifyIdentity.on("error", function (err) {
          console.error("Erro no Netlify Identity (home):", err);
        });
      }
    </script>
  </body>
</html>
